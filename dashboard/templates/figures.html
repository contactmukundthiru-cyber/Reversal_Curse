{% extends "base.html" %}

{% block title %}Figures - Reversal Curse{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Publication Figures</h1>
    <button id="generate-btn" class="btn btn-primary">
        <i class="bi bi-image"></i> Generate All Figures
    </button>
</div>

<div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    Generate publication-ready figures in PDF, PNG, and SVG formats.
    Figures are formatted according to Nature Human Behaviour guidelines.
</div>

<div id="loading" class="text-center py-5" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Generating...</span>
    </div>
    <p class="mt-3">Generating figures...</p>
</div>

<div id="figures-list" class="row">
    <!-- Figures will be displayed here -->
</div>

<div id="no-figures" class="text-center py-5 text-muted">
    <i class="bi bi-image" style="font-size: 48px;"></i>
    <p class="mt-3">Click "Generate All Figures" to create publication figures</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('generate-btn').addEventListener('click', async function() {
    const loading = document.getElementById('loading');
    const figuresList = document.getElementById('figures-list');
    const noFigures = document.getElementById('no-figures');

    loading.style.display = 'block';
    noFigures.style.display = 'none';
    figuresList.innerHTML = '';

    try {
        const response = await fetch('/api/generate-figures', {
            method: 'POST'
        });
        const data = await response.json();

        loading.style.display = 'none';

        if (data.success) {
            data.figures.forEach(fig => {
                const card = document.createElement('div');
                card.className = 'col-md-6 mb-4';
                card.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <strong>${fig.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">Generated files:</p>
                            <ul class="list-unstyled mb-0">
                                ${fig.paths.map(p => `<li><code>${p}</code></li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                figuresList.appendChild(card);
            });
        } else {
            alert('Error generating figures: ' + data.error);
        }
    } catch (error) {
        loading.style.display = 'none';
        alert('Error: ' + error.message);
    }
});
</script>
{% endblock %}
